# 硬件综合与 EDA 领域 (Hardware & EDA)

利用 Chomsky 的空间层（Spatial Layer）原子，可以将其作为硬件描述语言（HDL）的高级综合（HLS）寻优后端。

## 核心用法
1. **意图映射**：
   - 将逻辑运算映射为 `IKun` 节点。
   - 利用 `Pipe` 声明流水线级，利用 `Reg` 显式标记寄存器插入点。
2. **时序驱动的寻优**：
   - **重定步 (Retiming)**：在 E-Graph 中移动 `Reg` 节点的位置，寻找满足时钟频率要求的最优流水线切分方案。
   - **算子强度削减**：将复杂的乘法器重写为移位和加法的组合。
3. **空间约束寻优**：利用 `SpatialContext` 引导成本模型关注面积（Area）和布线拥塞度。

## 侧重点
- **精细周期模型**：成本模型需要精确到门级延迟（Gate Delay）。
- **并行性提取**：利用 `Map` 的原子性自动识别可展开的硬件并行单元。
- **功耗优化**：通过等价变换寻找降低翻转率（Switching Activity）的逻辑结构。

## 典型项目示例

1. **RISC-V 核心 HLS 优化 (RISC-V HLS)**：
   - **背景**：基于 `chomsky-adapter-riscv` 的高层综合（HLS）后端。
   - **应用**：将 C 语言描述的算法逻辑映射为 `IKun` 节点，利用 Chomsky 的**重定步 (Retiming)** 规则自动在关键路径上插入寄存器。例如，在一个 FIR 滤波器实现中，Chomsky 自动识别乘累加操作的瓶颈，并将其展开为流水线形式以提升时钟频率。

2. **Oak-Verilog 逻辑重构工具**：
   - **背景**：结合 `oaks` 的 Verilog 解析能力与 Chomsky 的变换引擎。
   - **应用**：解析现有的 RTL 代码，将其转换为中间表示。利用“算子强度削减”规则将复杂的 `a * 10` 转换为 `(a << 3) + (a << 1)`，并利用 E-Graph 的全局视图寻找跨模块的逻辑合并机会，减少门电路总数。

3. **Spatial Layer 资源分配器**：
   - **背景**：针对 FPGA 面积受限场景的资源映射器。
   - **应用**：利用 `SpatialContext` 定义硬件约束。在映射过程中，Chomsky 的成本模型会计算每个算子占用的 LUT 和 FF 资源。通过 `Choice` 算子，系统可以在“时间换空间”（串行执行）和“空间换时间”（并行展开）之间自动寻找满足面积限制的最优解。
